graph TB
    subgraph Frontend["ğŸ¨ FRONTEND (React + TypeScript)"]
        Dashboard["ğŸ“Š Dashboard<br/>/dashboard"]
        Projects["ğŸ“ Projects<br/>/project/:id"]
        Products["ğŸ›ï¸ Products<br/>/products"]
        AIGen["ğŸ¤– AI Generator<br/>/generate<br/>â€¢ Bulk CSV Upload<br/>â€¢ AI Prompts"]
        Scraper["ğŸ” Web Scraper<br/>/scraper<br/>â€¢ URL Scraping<br/>â€¢ Supplier Mgmt"]
        Pixi["ğŸ“ˆ Pixi Compare<br/>/pixi-compare<br/>â€¢ CSV Upload<br/>â€¢ Project Mode"]
    end

    subgraph Auth["ğŸ” AUTHENTICATION"]
        AuthMW["Passport.js Middleware<br/>â€¢ JWT Token Validation<br/>â€¢ Multi-Tenant Isolation<br/>â€¢ organization_id"]
    end

    subgraph API["âš™ï¸ BACKEND API (Express.js)"]
        AuthAPI["ğŸ”‘ /api/auth/*<br/>â€¢ login<br/>â€¢ register<br/>â€¢ logout"]
        ProjectAPI["ğŸ“‚ /api/projects<br/>â€¢ CRUD<br/>â€¢ Multi-tenant"]
        ProductAPI["ğŸ›’ /api/products<br/>â€¢ CRUD<br/>â€¢ Multi-tenant"]
        GenAPI["ğŸ¯ /api/generate<br/>â€¢ AI Bulk Gen<br/>â€¢ Usage Tracking<br/>â€¢ Tier Limits"]
        ScraperAPI["ğŸ•·ï¸ /api/scraper/*<br/>â€¢ scrapeUrl<br/>â€¢ suppliers<br/>â€¢ profiles"]
        PixiAPI["ğŸ“Š /api/pixi/*<br/>â€¢ compare<br/>â€¢ compare-project<br/>â€¢ cache"]
    end

    subgraph Services["ğŸ”§ SERVICE LAYER"]
        AIService["ğŸ§  AI Service<br/>(OpenAI GPT-4o-mini)<br/>â€¢ Prompts & Subprompts<br/>â€¢ Templates<br/>â€¢ Usage Tracking"]
        ScraperService["ğŸ” Scraper Service<br/>(Cheerio)<br/>â€¢ CSS Selectors<br/>â€¢ Auto-detect<br/>â€¢ Table Parser"]
        PixiService["ğŸ“¡ Pixi Service<br/>(Pixi ERP API)<br/>â€¢ ItemSearch<br/>â€¢ Matching Logic<br/>â€¢ 5-min Cache"]
        StripeService["ğŸ’³ Stripe Service<br/>â€¢ Subscriptions<br/>â€¢ Trial Mode<br/>â€¢ Tier Limits"]
        SupabaseStorage["ğŸ’¾ Supabase Storage<br/>â€¢ CRUD Operations<br/>â€¢ Mappers<br/>â€¢ Batch Updates<br/>â€¢ Organization Filter"]
    end

    subgraph Database["ğŸ—„ï¸ DATABASE (PostgreSQL/Supabase)"]
        Orgs["ğŸ‘¥ organizations<br/>â€¢ id (PK)<br/>â€¢ name<br/>â€¢ created_at"]
        Users["ğŸ‘¤ users<br/>â€¢ id (PK)<br/>â€¢ email<br/>â€¢ password<br/>â€¢ organization_id<br/>â€¢ role"]
        ProjectsDB["ğŸ“ projects<br/>â€¢ id (PK)<br/>â€¢ name<br/>â€¢ organization_id"]
        ProductsDB["ğŸ›ï¸ products_in_projects<br/>â€¢ id (PK)<br/>â€¢ project_id<br/>â€¢ product_name<br/>â€¢ pixi_status â­<br/>â€¢ pixi_ean â­<br/>â€¢ pixi_checked_at â­"]
        Suppliers["ğŸ“¦ suppliers<br/>â€¢ id (PK)<br/>â€¢ name<br/>â€¢ suppl_nr â­<br/>â€¢ selectors<br/>â€¢ organization_id"]
        APILogs["ğŸ“ api_usage_logs<br/>â€¢ id (PK)<br/>â€¢ user_id<br/>â€¢ organization_id<br/>â€¢ api_calls<br/>â€¢ timestamp"]
    end

    subgraph External["ğŸŒ EXTERNAL SERVICES"]
        OpenAI["ğŸ¤– OpenAI API<br/>GPT-4o-mini<br/>â€¢ Text Generation<br/>â€¢ Streaming<br/>â€¢ Token Tracking"]
        PixiERP["ğŸ“Š Pixi ERP<br/>ItemSearch API<br/>â€¢ artikelnummer<br/>â€¢ produktname<br/>â€¢ EANUPC"]
        StripeAPI["ğŸ’³ Stripe API<br/>â€¢ Starter Plan<br/>â€¢ Pro Plan<br/>â€¢ Enterprise"]
    end

    %% Frontend connections
    Dashboard --> AuthMW
    Projects --> AuthMW
    Products --> AuthMW
    AIGen --> AuthMW
    Scraper --> AuthMW
    Pixi --> AuthMW

    %% Auth to API
    AuthMW --> AuthAPI
    AuthMW --> ProjectAPI
    AuthMW --> ProductAPI
    AuthMW --> GenAPI
    AuthMW --> ScraperAPI
    AuthMW --> PixiAPI

    %% API to Services
    AuthAPI --> SupabaseStorage
    ProjectAPI --> SupabaseStorage
    ProductAPI --> SupabaseStorage
    GenAPI --> AIService
    ScraperAPI --> ScraperService
    PixiAPI --> PixiService

    %% Services connections
    AIService --> SupabaseStorage
    ScraperService --> SupabaseStorage
    PixiService --> SupabaseStorage
    StripeService --> SupabaseStorage

    %% Storage to Database
    SupabaseStorage --> Orgs
    SupabaseStorage --> Users
    SupabaseStorage --> ProjectsDB
    SupabaseStorage --> ProductsDB
    SupabaseStorage --> Suppliers
    SupabaseStorage --> APILogs

    %% External Services
    AIService --> OpenAI
    PixiService --> PixiERP
    StripeService --> StripeAPI

    %% Database relationships
    Users -.->|belongs to| Orgs
    ProjectsDB -.->|belongs to| Orgs
    ProductsDB -.->|belongs to| ProjectsDB
    Suppliers -.->|belongs to| Orgs
    APILogs -.->|tracks| Users

    classDef frontend fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef auth fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef api fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef service fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef database fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef external fill:#fff9c4,stroke:#f9a825,stroke-width:2px

    class Dashboard,Projects,Products,AIGen,Scraper,Pixi frontend
    class AuthMW auth
    class AuthAPI,ProjectAPI,ProductAPI,GenAPI,ScraperAPI,PixiAPI api
    class AIService,ScraperService,PixiService,StripeService,SupabaseStorage service
    class Orgs,Users,ProjectsDB,ProductsDB,Suppliers,APILogs database
    class OpenAI,PixiERP,StripeAPI external
